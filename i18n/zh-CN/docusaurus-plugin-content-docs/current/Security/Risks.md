# 风险概述

## I. 通胀风险

Overlay协议使用原生代币OVL结算所有的PnL，OVL作为建仓的抵押品，在赢利时被铸造，而在亏损时被销毁。因此，该协议面临的主要风险是OVL通胀过度。该风险通过以下一系列机制来管理。

### A.资金费用

一般而言，其他永续合约平台通过收取资金费用来平衡合约价格和现货价格的差异，而Overlay则基于多空持仓之间的差别收取资金费用。由于Overlay从预言机获取价格，因此不需要通过资金费用来减少基差（合约价格和现货价格之间的差异）。

例如，如果多头持仓比空头多，那么多头将向空头支付资金费用。由于多空持仓之间不平衡的程度导致协议的潜在通货膨胀风险，因此资金费用会用于激励用户减少此不平衡。

### B.上限

该协议在需要的时候会通过限制PnL或增加新仓位来避免通胀风险，具体则取决于由DAO治理设置的风险参数。以下是相关风险参数的细节：

- 收益上限：Overlay将设定每个仓位的收益上限，以限制该协议中每个仓位的PnL；此上限将由社区/DAO通过官方的治理流程为每个市场制定。这将有助于该协议限制长尾资产交易的通胀风险。
- 未平仓量（OI）上限：OI上限将被强制执行，以限制Overlay市场可承担的仓位数量。如若没有OI上限，收益上限不会有效，因为用户可以打开多个小仓位来规避收益上限。
- 熔断机制：收益上限和OI上限共同限制市场在任何单个仓位上可以铸造的代币数量。熔断机制则进一步限制了市场在给定时间内由于多个仓位需要铸造的数量。当近期铸造的OVL数量超过预期时，可创建的新仓位的规模将被显著降低一段时间，以冷却市场，并将特定市场的通胀率带回与该协议预期的通胀相一致的水平。

### C. 清算

达到清算阈值的亏损头寸可以被任何调用合约上清算函数的人进行清算，并且清算者会获得奖励。用户遭受的 OVL 亏损中的一部分会被销毁，而另一部分会被存到费用资金库。

需要注意的一点是，与上述功能相关的风险参数都由 Overlay 治理机构设置。因此，决定通货膨胀风险与平台潜在交易量之间的平衡取决于代币持有人。在一个极端下，风险参数太过严格，虽然实现了零通膨风险，但也抑制了所有交易量。在另一端，风险参数设置的过于松散，虽然实现了大规模交易量，但却伴随着重大的通货膨胀风险。

## II. 智能合约风险

智能合约不可篡改的特性对于透明度来说是极好的，但同时也使它们更脆弱。除非相关的功能在智能合约创建时就被纳入（这会导致其它不同类型的风险），通常智能合约在部署后无法修改。

如果代码中存在错误/漏洞，可能会导致无法使用该协议。漏洞甚至可能导致协议暴露在黑客的攻击下，进而导致可能的资金损失。虽然智能合约带来的风险可以通过审核和测试进行缓解，但仍然存在错误/漏洞风险。

Overlay已经通过了两次全面的审计：分别为Spearbit和Least Authority。有关Overlay的审计的更多详细信息，请在这里了解。

## III. 智能合约控制/访问

如果没有正确实施对智能合约的访问，这可能被恶意利用，从而导致被夺取智能合约的控制权。这会使协议和智能合约中的资金处于风险之中。

## IV. 预言机风险

Overlay市场的价格数据基于从预言机间接性获取的数值。预言机是帮助协议从智能合约生态系统之外获取所需的信息/数据（涉及价格数据或其他数据）的第三方服务。任何帮助获取资产价格数据的工具都是“价格预言机”。Overlay就能接入几乎任何预言机，只要预言机提供的信息流是不可操控且不可预测的。

有些时候，在当前时间可用的数据和数据流的实际最新数值之间存在一定的时间延迟。也就是说，预言机的价格可能没有及时反应最新的实际价格。这种延迟可以被抢先交易（frontrunning）用户滥用获利。抢先交易在以太坊主网上是一个更为明显的问题。

几种加密攻击都集中于通过操作预言机价格提供来破坏预言机数据。这可能会导致攻击者在使用了被破坏的预言机数据的另一个平台上获得巨额收益。这些攻击通常涉及闪电贷来操纵预言机数据，并且在同一区块内完成（闪电贷的本质）。

Overlay通过实现以下功能来缓解预言机风险：

### A. 时间加权平均价格（TWAP）

TWAP或“时间加权平均价格”是资产在一定时间段内的平均价格。 TWAP价格通常由传统市场和加密市场参与者用于在最小化市场影响的同时执行大额订单（分批次）。

在DeFi中，使用TWAP而不是现货价格作为价格预言机是一种常见做法。 TWAP使预言机操纵攻击变得显著的更昂贵及繁琐。这是因为TWAP数据需要在多个区块中持续进行攻击，这是非常昂贵的，并且通常不能通过闪电贷来执行此攻击 - 这种攻击需要攻击者提供实际流动性。

### B. 买卖价差

买卖价差是在任何特定时间点可以买入或卖出资产的价格之间的差异或“价差”。在传统交易所（基于CLOB模型）中，这可以被视为买家愿意支付的最高价格和卖家提供的最低价格之间的差异。

Overlay在买价和卖价之间引入了一个固定价差，以便用户无法从TWAP价格预言机固有的延迟中获利（因为它是在一定时间段内的价格平均值）。

### C. 市场影响

市场影响是由于执行特定头寸而导致资产价格的变化。价格影响通常是市场流动性的一个函数-市场流动性越强，相同规模头寸带来的价格影响越小。

Overlay市场上的大额头寸会受到滑点的影响，其模拟真实市场的方式能大幅限制攻击者的潜在利润（与Overlay市场如果不模拟市场影响的情况相比）。这种市场影响是由1.滚动时间窗口中的买/卖一方的累积未平仓合约和2.每个市场的价格影响常数的组合确定的（其中价格影响常数可通过DAO治理更改）。因此，在Overlay上，根据订单大小和每个市场的影响常数，价格影响被添加到买价和卖价中。

### D. 现价操纵

在特定情况下，例如当价格预言机是Uniswap v3 预言机时，协议会追踪流动性池中的流动性和价格变动，并相应调整其风险参数。











